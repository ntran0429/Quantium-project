"0","#### Scale pre-trial control sales to match pre-trial trial store sales"
"0",""
"0","scalingFactorForControlSales <- preTrialMeasures[STORE_NBR == trial_store &"
"0","YEARMONTH < 201902, sum(totSales)]/preTrialMeasures[STORE_NBR == control_store &"
"0","YEARMONTH < 201902, sum(totSales)]"
"0",""
"0","#### Apply the scaling factor"
"0","measureOverTimeSales <- measureOverTime"
"0","scaledControlSales <- measureOverTimeSales[STORE_NBR == control_store, ][ ,"
"0","controlSales := totSales * scalingFactorForControlSales]"
"0",""
"0","#### Calculate the percentage difference between scaled control sales and trial sales"
"0","#### Hint: When calculating percentage difference, remember to use absolute difference"
"0","percentageDiff <- merge(scaledControlSales[,c(""controlSales"",""YEARMONTH"")], measureOverTimeSales[STORE_NBR == trial_store, c(""totSales"",""YEARMONTH"")], by = ""YEARMONTH"")[, percentDiff := abs(controlSales-totSales)/controlSales]"
"0",""
"0","#### As our null hypothesis is that the trial period is the same as the pre-trial"
"0","#### period, let's take the standard deviation based on the scaled percentage difference"
"0","#### in the pre-trial period"
"0","stdDev <- sd(percentageDiff[YEARMONTH < 201902, percentDiff])"
"0",""
"0","degreesOfFreedom <- 7"
"0",""
"0","#### Trial and control store total sales"
"0","####  Create a table with sales by store type and month."
"0","#### We only need data for the trial and control store."
"0","measureOverTimeSales <- measureOverTime"
"0","pastSales <- measureOverTimeSales[, Store_type := ifelse(STORE_NBR == trial_store, ""Trial"","
"0","                                                         ifelse(STORE_NBR == control_store, ""Control"",""Other stores""))][, totSales := mean(totSales), by = c(""Store_type"",""YEARMONTH"")][, TransactionMonth := as.Date(paste(as.numeric(YEARMONTH) %/% 100, as.numeric(YEARMONTH) %% 100, 1, sep = ""‐""), ""%Y‐%m‐%d"")][Store_type %in% c(""Trial"",""Control""), ]"
"0",""
"0","#### Calculate the 5th and 95th percentile for control store sales."
"0","#### Hint: The 5th and 95th percentiles can be approximated by using two standard"
"0","#### deviations away from the mean."
"0","#### Hint2: Recall that the variable stdDev earlier calculates standard deviation"
"0","# in percentages, and not dollar sales."
"0","pastSales_Controls95 <- pastSales[Store_type == ""Control"",][, totSales := totSales * (1+ 2*stdDev)][, Store_type := ""Control 95th % confidence interval""]"
"0",""
"0",""
"0","pastSales_Controls5 <- pastSales[Store_type == ""Control"", ][, totSales := totSales * (1- 2*stdDev)][, Store_type := ""Control 5th % confidence interval""]"
"0",""
"0","#### Then, create a combined table with columns from pastSales,"
"0","#### pastSales_Controls95 and pastSales_Controls5"
"0","trialAssessment <- rbind(pastSales,pastSales_Controls95,pastSales_Controls5)"
"0",""
"0","#### Plotting these in one nice graph"
"0","ggplot(trialAssessment, aes(TransactionMonth, totSales, color = Store_type)) +"
"0","  geom_rect(data = trialAssessment[ YEARMONTH < 201905 & YEARMONTH > 201901 ,],"
"0","aes(xmin = min(TransactionMonth), xmax = max(TransactionMonth), ymin = 0 , ymax ="
"0","Inf, color = NULL), show.legend = FALSE) +"
"0","  geom_line() +"
"0","  geom_point() +"
"0","  labs(x = ""Month of operation"", y = ""Total sales"", title = ""Total sales by month"")"
"0",""
