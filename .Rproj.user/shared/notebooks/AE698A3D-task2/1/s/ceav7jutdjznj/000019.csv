"0","#### This would be a repeat of the steps before for total sales"
"0","#### Scale pre-trial control customers to match pre-trial trial store customers"
"0",""
"0","scalingFactorForControlCust <- preTrialMeasures[STORE_NBR == trial_store & YEARMONTH < 201902, sum(nCustomers)]/preTrialMeasures[STORE_NBR == control_store & YEARMONTH < 201902, sum(nCustomers)]"
"0",""
"0","#### Apply the scaling factor"
"0","measureOverTimeCusts <- measureOverTime"
"0","scaledControlCustomers <- measureOverTimeCusts[STORE_NBR == control_store,][ , controlCustomers := nCustomers"
"0","* scalingFactorForControlCust][, Store_type := ifelse(STORE_NBR== trial_store, ""Trial"",ifelse(STORE_NBR == control_store, ""Control"", ""Other stores""))]"
"0",""
"0","#### Calculate the percentage difference between scaled control sales and trial sales"
"0","percentageDiff <- merge(scaledControlCustomers[, c(""YEARMONTH"", ""controlCustomers"")],"
"0","                        measureOverTime[STORE_NBR == trial_store, c(""nCustomers"", ""YEARMONTH"")],"
"0","                        by = ""YEARMONTH"")[, percentageDiff := abs(controlCustomers-nCustomers)/controlCustomers]"
"0",""
"0",""
"0","#### As our null hypothesis is that the trial period is the same as the pre-trial"
"0","#### period, let's take the standard deviation based on the scaled percentage difference"
"0","#### in the pre-trial period"
"0","stdDev <- sd(percentageDiff[YEARMONTH < 201902 , percentageDiff])"
"0",""
"0","degreesOfFreedom <- 7"
"0",""
"0","#### Trial and control store number of customers"
"0","pastCustomers <- measureOverTimeCusts[ , Store_type := ifelse(STORE_NBR == trial_store, ""Trial"","
"0","                                                   ifelse(STORE_NBR == control_store, ""Control"", ""Other stores""))][, nCusts := mean(nCustomers), by =c(""YEARMONTH"", ""Store_type"")][Store_type %in% c(""Trial"", ""Control""), ][, TransactionMonth := as.Date(paste(as.numeric(YEARMONTH) %/% 100, as.numeric(YEARMONTH) %% 100, 1, sep = ""-""), ""%Y-%m-%d"")][Store_type %in% c(""Trial"", ""Control""),]"
"0",""
"0","#### Control store 95th percentile"
"0","pastCustomers_Controls95 <- pastCustomers[Store_type == ""Control"",][, nCusts := nCusts * (1 + stdDev * 2)][, Store_type := ""Control 95th % confidence interval""]"
"0",""
"0","#### Control store 5th percentile"
"0","pastCustomers_Controls5 <- pastCustomers[Store_type == ""Control"",][, nCusts := nCusts * (1 - stdDev * 2)][, Store_type := ""Control 5th % confidence interval""]"
"0",""
"0","trialAssessment <- rbind(pastCustomers, pastCustomers_Controls95,pastCustomers_Controls5)"
"0",""
"0","#### Plotting these in one nice graph"
"0","ggplot(trialAssessment, aes(TransactionMonth, nCusts, color = Store_type)) +"
"0","  geom_rect(data = trialAssessment[ YEARMONTH < 201905 & YEARMONTH > 201901 ,],"
"0","aes(xmin = min(TransactionMonth), xmax = max(TransactionMonth), ymin = 0 , ymax ="
"0","Inf, color = NULL), show.legend = FALSE) +"
"0","  geom_line() +"
"0","  geom_point() +"
"0","  labs(x = ""Month of operation"", y = ""Total number of customers"", title = ""Total"
"0","number of customers by month"")"
"0",""
