"0","#### Scale pre-trial control store sales to match pre-trial trial store sales"
"0","scalingFactorForControlSales <- "
"0","  preTrialMeasures[STORE_NBR == trial_store, sum(totSales)] / preTrialMeasures[STORE_NBR == control_store, sum(totSales)] "
"0","  "
"0",""
"0","#### Apply the scaling factor"
"0","measureOverTimeSales <- measureOverTime"
"0","scaledControlSales <- measureOverTimeSales[STORE_NBR == control_store, ][, controlSales := scalingFactorForControlSales*totSales]"
"0",""
"0",""
"0","#### Calculate the absolute percentage difference between scaled control sales and trial sales"
"0","percentageDiff <- merge(scaledControlSales[,c(""controlSales"",""YEARMONTH"")], measureOverTime[STORE_NBR == trial_store, c(""totSales"",""YEARMONTH"")], by=""YEARMONTH"")[, percentDiff := abs(totSales-controlSales)/controlSales]"
"0",""
"0",""
"0","#### As our null hypothesis is that the trial period is the same as the pre-trial"
"0","#### period, let's take the standard deviation based on the scaled percentage difference"
"0","#### in the pre-trial period"
"0","stdDev <- sd(percentageDiff[YEARMONTH < 201902, percentDiff])"
"0",""
"0","degreesOfFreedom <- 7"
"0","#### Trial and control store total sales"
"0","measureOverTimeSales <- measureOverTime"
"0","pastSales <- measureOverTimeSales[ , Store_type := ifelse(STORE_NBR == trial_store, ""Trial"","
"0","                                                   ifelse(STORE_NBR == control_store, ""Control"", ""Other stores""))"
"0","                                   ][, totSales := mean(totSales), by = c(""YEARMONTH"", ""Store_type"")"
"0","                                     ][, TransactionMonth := as.Date(paste(as.numeric(YEARMONTH) %/% 100, as.numeric(YEARMONTH) %% 100, 1, sep = ""-""), ""%Y-%m-%d"")"
"0","                                       ][Store_type %in% c(""Trial"", ""Control""),]"
"0",""
"0","#### Control store 95th percentile"
"0","pastSales_Controls95 <- pastSales[Store_type == ""Control"",][, totSales := totSales * (1 + stdDev * 2)][, Store_type := ""Control 95th % confidence interval""]"
"0",""
"0","#### Control store 5th percentile"
"0","pastSales_Controls5 <- pastSales[Store_type == ""Control"",][, totSales := totSales * (1 - stdDev * 2)][, Store_type := ""Control 5th % confidence interval""]"
"0",""
"0","trialAssessment <- rbind(pastSales, pastSales_Controls95, pastSales_Controls5)"
"0",""
"0","#### Plotting these in one nice graph"
"0","ggplot(trialAssessment, aes(TransactionMonth, totSales, color = Store_type)) +"
"0","  geom_rect(data = trialAssessment[ YEARMONTH < 201905 & YEARMONTH > 201901 ,],"
"0","            aes(xmin = min(TransactionMonth), xmax = max(TransactionMonth), "
"0","                ymin = 0 , ymax = Inf, color = NULL), show.legend = FALSE) +"
"0","  geom_line() +"
"0","  geom_point() +"
"0","  labs(x = ""Month of operation"", y = ""Total sales"", title = ""Total sales by month"")"
"0",""
